Index: app/src/main/java/it/volta/ts/easymask/networking/UploadManager.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package it.volta.ts.easymask.networking;\r\n\r\nimport java.io.BufferedReader;\r\nimport java.io.File;\r\nimport java.io.FileInputStream;\r\nimport java.io.IOException;\r\nimport java.io.InputStreamReader;\r\nimport java.io.OutputStream;\r\nimport java.io.OutputStreamWriter;\r\nimport java.io.PrintWriter;\r\nimport java.net.HttpURLConnection;\r\nimport java.net.URL;\r\nimport java.net.URLConnection;\r\n\r\n\r\npublic class UploadManager {\r\n    private static final String NEWLINE = \"\\r\\n\";\r\n\r\n    private final String boundary;\r\n\r\n    private HttpURLConnection cn;\r\n\r\n    private String charset;\r\n\r\n    private PrintWriter printWriter;\r\n\r\n    private OutputStream outStream;\r\n\r\n\tpublic UploadManager(String requestURL, String charset) throws IOException {\r\n\r\n            //crea un delimitatore univoco basato sul timestamp corrente\r\n            boundary = \"===\" + System.currentTimeMillis() + \"===\";\r\n\r\n            this.charset = charset;\r\n\r\n            URL url = new URL(requestURL);\r\n\r\n            cn = (HttpURLConnection) url.openConnection();\r\n            cn.setUseCaches(false);\r\n            //indichiamo il metodo POST\r\n            cn.setDoOutput(true);\r\n            cn.setDoInput(true);\r\n            cn.setRequestProperty(\"Content-Type\", \"multipart/form-data; boundary=\" + boundary);\r\n\r\n            outStream = cn.getOutputStream();\r\n            printWriter = new PrintWriter(new OutputStreamWriter(outStream, charset), true);\r\n        }\r\n\r\n        public void setHeaderField(String name, String value) {\r\n            printWriter.append(name + \": \" + value).append(NEWLINE);\r\n            printWriter.flush();\r\n        }\r\n\r\n        public void setFilePart(String fieldName, File uploadFile) throws IOException {\r\n            String fileName = uploadFile.getName();\r\n            printWriter.append(\"--\" + boundary).append(NEWLINE);\r\n            printWriter.append(\"Content-Disposition: form-data; name=\\\"\" + fieldName + \"\\\"; filename=\\\"\" + fileName + \"\\\"\").append(NEWLINE);\r\n            printWriter.append(\"Content-Type: \" + URLConnection.guessContentTypeFromName(fileName)).append(NEWLINE);\r\n            printWriter.append(\"Content-Transfer-Encoding: binary\").append(NEWLINE);\r\n            printWriter.append(NEWLINE);\r\n            printWriter.flush();\r\n\r\n            FileInputStream inputStream = new FileInputStream(uploadFile);\r\n            byte[] buffer = new byte[4096];\r\n            int bytesRead = -1;\r\n            while ((bytesRead = inputStream.read(buffer)) != -1) {\r\n                outStream.write(buffer, 0, bytesRead);\r\n            }\r\n            outStream.flush();\r\n            inputStream.close();\r\n\r\n            printWriter.append(NEWLINE);\r\n            printWriter.flush();\r\n        }\r\n\r\n        public void setFormField(String name, String value) {\r\n            printWriter.append(\"--\" + boundary).append(NEWLINE);\r\n            printWriter.append(\"Content-Disposition: form-data; name=\\\"\" + name + \"\\\"\");\r\n            printWriter.append(\"Content-Type: text/plain; charset=\" + charset).append(NEWLINE);\r\n            printWriter.append(NEWLINE);\r\n            printWriter.append(value).append(NEWLINE);\r\n            printWriter.flush();\r\n        }\r\n\r\n        public String getResponse() throws IOException {\r\n            StringBuffer response = new StringBuffer();\r\n\r\n            printWriter.append(NEWLINE).flush();\r\n            printWriter.append(\"--\" + boundary + \"--\").append(NEWLINE);\r\n            printWriter.close();\r\n\r\n            //verifichiamo la risposta del server\r\n            int status = cn.getResponseCode();\r\n            if (status == HttpURLConnection.HTTP_OK) {\r\n                BufferedReader reader = new BufferedReader(new InputStreamReader(cn.getInputStream()));\r\n                String line = null;\r\n                while ((line = reader.readLine()) != null) {\r\n                    response.append(line);\r\n                }\r\n                reader.close();\r\n                cn.disconnect();\r\n            } else {\r\n                throw new IOException(\"Server status: \" + status);\r\n            }\r\n\r\n            return response.toString();\r\n        }\r\n    }\r\n\r\n
===================================================================
diff --git a/app/src/main/java/it/volta/ts/easymask/networking/UploadManager.java b/app/src/main/java/it/volta/ts/easymask/networking/UploadManager.java
--- a/app/src/main/java/it/volta/ts/easymask/networking/UploadManager.java	
+++ b/app/src/main/java/it/volta/ts/easymask/networking/UploadManager.java	
@@ -99,6 +99,7 @@
                 }
                 reader.close();
                 cn.disconnect();
+
             } else {
                 throw new IOException("Server status: " + status);
             }
